{% extends 'base.html' %}

{% block head %}
    <script src="/static/js/load_content.js"></script>
    <!--Page specificc script-->
    {% block script %}{% endblock %}
    <!--Title-->
    <title>
        {% block title %}Wordglimpse{% endblock %}
    </title>
{% endblock %}

{% block body %}
    <!-- ==== HEADER ==== -->
    <header class="fixed-top bg-body d-flex flex-row justify-content-between align-items-center">
        <!--Left Menu Btn-->
        <button type="button" class="btn" title="Menu" data-bs-toggle="offcanvas" data-bs-target="#leftMenu" aria-controls="leftMenu">
            <i class="bi bi-list" style="font-size:25px;"></i>
        </button>
        <!--Logo-->
        <a href="/" title="Wordglimpse" class="navbar-brand">WORDGLIMPSE</a>
        <!--Search Container-->
        <div class="d-none d-sm-inline-block" id="searchContainer">
            <form action="/search" method="get" class="bg-body d-flex flex-row align-items-center" id="searchForm">
                <button type="button" class="btn d-sm-none" onclick="closeSearch()">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <input class="form-control" type="search" name="q" id="searchInput" placeholder="Search.." autocomplete="off" autofocus>
                <button type="submit" class="btn" title="Search">
                    <i class="bi bi-search"></i>
                </button>
            </form>
        </div>
        <!--Search btn for extra small devices-->
        <button type="button" class="btn d-sm-none" title="Search" onclick="openSearch()">
            <i class="bi bi-search"></i>
        </button>
    </header>

    <!-- ==== Left Menu ==== -->
    <section class="offcanvas offcanvas-start bg-body-tertiary" tabindex="-1" id="leftMenu" aria-labelledby="leftMenu">
        <div class="offcanvas-header">
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <!--First div-->
            <div class="offcanvas-div card bg-body">
                <a href="/popular" class="btn div-item" title="Popular">
                    <i class="bi bi-star"></i>
                    <span>Popular</span>
                </a>
                <a href="/recent" class="btn div-item" title="Recent">
                    <i class="bi bi-clock"></i>
                    <span>Recent</span>
                </a>
                <a href="/author" class="btn div-item" title="Author">
                    <i class="bi bi-person-fill-check"></i>
                    <span>Author</span>
                </a>
            </div>
            <!--Categories div-->
            <div class="offcanvas-div card bg-body">
                <button class="btn d-flex flex-row justify-content-between align-items-center w-100" type="button"
                    data-bs-toggle="collapse" data-bs-target="#collapseAccordion" aria-expanded="true"
                    aria-controls="collapseAccordion" onclick="toggleArrow()">
                    <span>Categories</span>
                    <i class="bi bi-chevron-down" id="keyArrDown"></i>
                </button>
                <div id="collapseAccordion" class="collapse" data-bs-parent="#categoryAccordion">
                    <ul class="list-unstyled">
                        {% for category in categories %}
                        <li>
                            <a href="/search?category={{ category }}" class="btn text-primary div-item" title="{{ category }}">{{category|title}}</a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <!--Setting div-->
            <div class="offcanvas-div card bg-body p-3">
                <div class="d-flex flex-row align-items-center mb-3" style="gap: 10px;">
                    <i class="icon-container">
                        <i class="bi bi-gear"></i>
                    </i>
                    <span>Settings</span>
                </div>
                <div id="settings">
                    <!--Theme Toggler-->
                    <div class="d-flex flex-row justify-content-between align-items-center p-2">
                        <div><label for="themeToggler">Dark Mode</span></div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="themeToggler">
                        </div>
                    </div>
                    <!--Adjust Text Size-->
                    <div class="d-flex flex-row justify-content-between align-items-center p-2">
                        <label for="textSizeSelector" style="flex:2;">Text size</label>
                        <select class="form-select" id="textSizeSelector" style="flex:1;">
                            <option value="smaller">Smaller</option>
                            <option value="medium" selected>Medium</option>
                            <option value="larger">Larger</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="p-3">
            <small><a href="/about" title="About" class="text-body-secondary d-inline-block p-1">About</a></small>
            <small><a href="/feedback" title="Feedback" class="text-body-secondary d-inline-block p-1">Feedback</a></small>
        </div>
    </section>

    <!-- ==== MAIN SECTION ==== -->
    <main class="tab-content main bg-body" id="mainTabContent">
        <!-- CONTENT TAB for other pages like search result, profile etc -->
        <div class="tab-pane fade" id="content-tab-pane" role="tabpanel" aria-labelledby="content-tab" tabindex="0">
            {% block content %}
                <div class="text-center mt-5">
                    <h5>Sorry! we could not find, what you are looking for.</h5>
                </div>
            {% endblock %}
        </div>
        <!--HOME TAB-->
        <div class="tab-pane fade" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
            Home content goes here...
        </div>
        {% if user %}
        <!--FOLLOWING TAB-->
        <div class="tab-pane fade" id="following-tab-pane" role="tabpanel" aria-labelledby="following-tab" tabindex="0">
            Following content goes here...
        </div>
        <!--SAVED TAB-->
        <div class="tab-pane fade" id="saved-tab-pane" role="tabpanel" aria-labelledby="saved-tab" tabindex="0">
            Saved content goes here...
        </div>
        {% endif %}
    </main>

    <!-- ==== BOTTOM NAV ==== -->
    <nav class="sidenav-md-left d-block d-md-flex flex-column justify-content-between bg-body">
        <div class="bottom-nav bg-body" role="tablist">
            <button class="btn active" type="button" title="Home" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" role="tab" aria-controls="home-tab-pane" aria-selected="false" onclick="load_content('/')">
                <i class="bi bi-house"></i>
                <span>Home</span>
            </button>
            <button class="btn" type="button" title="Following" {% if user %} id="following-tab" data-bs-toggle="tab" data-bs-target="#following-tab-pane" role="tab" aria-controls="following-tab-pane" aria-selected="true" onclick="load_content('/following')" {% else %} data-bs-toggle="modal" data-bs-target="#loginRequiredModal" {%endif %}>
                <i class="bi bi-collection"></i>
                <span>Following</span>
            </button>
            <button class="btn d-md-none" type="button" title="Create New" {% if user %}
                data-bs-toggle="offcanvas" data-bs-target="#newPostCard" aria-controls="newPostCard" {% else %}
                data-bs-toggle="modal" data-bs-target="#loginRequiredModal" {% endif %}>
                <i class="bi bi-plus bg-primary text-white rounded-circle px-2" style="font-size:35px;"></i>
            </button>
            <button class="btn" type="button" title="Saved" {% if user %} id="saved-tab" data-bs-toggle="tab"
                data-bs-target="#saved-tab-pane" role="tab" aria-controls="saved-tab-pane" aria-selected="true"
                onclick="load_content('/saved')" {% else %} data-bs-toggle="modal" data-bs-target="#loginRequiredModal" {%
                endif %}>
                <i class="bi bi-bookmark"></i>
                <span>Saved</span>
            </button>
            <button class="btn" type="button" title="Account" {% if user %} data-bs-toggle="offcanvas"
                data-bs-target="#sideNav" aria-controls="sideNav" {% else %} data-bs-toggle="modal"
                data-bs-target="#loginRequiredModal" {% endif %}>
                {% if user %}
                    <img src="{% if user.avatar %}{{ user.avatar }}{% else %}/static/image/user.png{% endif %}" title="Account">
                {% else %}
                    <i class="bi bi-person-circle"></i>
                {% endif %}
                <span>Account</span>
            </button>
        </div>
        <!-- Post Button for medium devices -->
        <div class="d-none d-md-flex justify-content-center align-items-center">
            <button class="btn btn-sm p-0 btn-primary d-flex justify-content-center align-items-center" type="button"
                title="Create New" style="width:100%;max-width: 300px;" {% if user %} data-bs-toggle="offcanvas"
                data-bs-target="#newPostCard" aria-controls="newPostCard" {% else %} data-bs-toggle="modal"
                data-bs-target="#loginRequiredModal" {% endif %}>
                <i class="bi bi-plus" style="font-size:35px;"></i>
                <span>Create New</span>
            </button>
        </div>
    </nav>
    
    <!-- Modals if user is logged in and if not logged in trigger login required modal -->
    {% if user %}

    {% else %}
        <!-- LOGIN Required Modal -->
        <div class="modal" id="loginRequiredModal" tabindex="-1" aria-labelledby="loginRequiredModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p class="d-flex flex-row justify-content-between align-items-center"><span>Login to continue</span>
                        <a href="/login" class="btn btn-primary" title="login">Login</a></p>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
     
{% endblock %}